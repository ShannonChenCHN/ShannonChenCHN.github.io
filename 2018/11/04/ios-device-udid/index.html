<!DOCTYPE html><html lang=""><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> [iOS 开发] 如何获取设备唯一标识？以及多个App间如何共享同一个设备唯一标识？ · Shannon's Blog</title><meta name="description" content="[iOS 开发] 如何获取设备唯一标识？以及多个App间如何共享同一个设备唯一标识？ - ShannonChenCHN"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Shannon's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">TAG</a></li><li class="nav-list-item"><a href="https://github.com/ShannonChenCHN" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">[iOS 开发] 如何获取设备唯一标识？以及多个App间如何共享同一个设备唯一标识？</h1><div class="post-info">Nov 4, 2018</div><div class="post-content"><blockquote>
<p><strong>更新2016.12.31</strong>：最近发现项目中用的<code>OpenUDID</code> 会导致应用崩溃，已更换为 <code>FCUUID</code>，需要注意的是，原来 <code>OpenUDID</code> 记录的设备 id （<strong>40位</strong>）是不能直接迁移到 <code>FCUUID</code> 的，尽管 <code>FCUUID</code> 提供了这样的接口，因为 <code>OpenUDID</code> 保存的设备 id 并不是直接来自系统的 <em>UUID</em>，而是经过<code>OpenUDID</code> 处理过的，所以不符合 <code>FCUUID</code> 中对 <em>UUID</em> 校验的规则（<strong>32位或者36位</strong>）。因此如果你想继续使用原来的设备 id，就需要自己使用存到 KeyChain 里面了。</p>
</blockquote>
<p>最近公司项目有一个针对新用户的需求，对新用户的筛选条件是<code>新账号&amp;&amp;新设备？YES：NO</code>。烦人的问题就是这个对于新设备的判断了，相比轻松就能搞定的android开发者来说，iOS开发者真是有苦难言，谁让苹果公司真是时刻不忘一切为了用户啊——从2013年5月1日起，你再想直接拿用户设备的UDID？没门！<br>获取设备唯一标识符本来就不易，但是考虑到我司的两款app有可能同时上新用户活动，那就还得想办法保证<strong>同一设备上两款不同app获取到的标识是相同的</strong>，我滴个亲娘啊……</p>
<p>那怎么办呢？当然百度啊！找来找去，找到两个解决方案：<a href="https://github.com/ylechelle/OpenUDID" target="_blank" rel="noopener">OpenUDID</a>框架和<a href="https://github.com/fabiocaccamo/FCUUID" target="_blank" rel="noopener">FCUUID</a>框架。这两个框架都是采用“一次性创建CFUUID+持久性存储”的策略来实现山寨版的UDID的。（ps：这些造轮子的人真是牛x！感谢他们为我们广大码农提供便利！）</p>
<ul>
<li><strong>OpenUDID</strong></li>
</ul>
<p><em>问题一：现在还能用OpenUDID吗？</em><br>OpenUDID的作者已经在github上注明了<code>[OpenUDID IS NOW DEPRECATED]</code>，时间是<code>June 7 2013</code>，并且作者还特别提醒我们在使用之前好好读一下这篇博客 <a href="http://blog.appsfire.com/udid-is-dead-openudid-is-deprecated-long-live-advertisingidentifier/" target="_blank" rel="noopener">UDID is dead, OpenUDID is deprecated, long live advertisingIdentifier!</a>。究竟为甚么被废弃了，我也是一头雾水，我司两款产品都一直在使用OpenUDID来作埋点统计，而且我自己也用真机测试过了，并没有发现什么未知异常。对此，github上也有人在2014年时提出了issue-<a href="https://github.com/ylechelle/OpenUDID/issues/59" target="_blank" rel="noopener">Why deprecate OpenUDID ? #59</a>，but…，没有人给出合理的解释。从github上的issue来看，使用者碰到的问题不少。知乎上一位使用OPenUDID的网友也声称遇到过不同设备的OpenUDID值相同的问题：<a href="https://www.zhihu.com/question/21797147" target="_blank" rel="noopener">不同设备的OpenUDID有可能重复吗？</a></p>
<p><em>问题二：怎么用OpenUDID来实现我们的需求？</em><br>OpenUDID的原理是用UIPasteboard来保存CFUUID，在iOS7以前，所有应用都可以访问同一个剪切板上存储的内容，但是iOS7以后只允许使用相同team ID的apps才能共享同一个剪切板上的数据。OpenUDID采用+ pasteboardWithName: create:方法来获取剪切板中的值，根据苹果的官方文档，可以得知，该方法返回的pasteboard可以用来在一个app内部或者两个<strong>拥有相同的team ID</strong>的app之间传递数据。<br>我用自己的个人证书创建了两个不同的app，这时就能满足两个不同的app拥有相同的team ID的条件了，连上iPhone5s分别运行，结果显示的是一样的值，说明OpenUDID是暂时可行的。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/814356-b31ee3390f0d5a20.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="UIPasteboard官方文档.png"></p>
<ul>
<li><strong>FCUUID</strong><br><em>问题一：FCUUID框架能满足需求吗？</em><br>该框架诞生于2015年10月左右，其实现原理就是CFUUID+KeyChain，跟OpenUDID是差不多的，只是存储方式不同，需要注意的是，FCUUID框架依赖于框架<a href="https://github.com/kishikawakatsumi/UICKeyChainStore" target="_blank" rel="noopener">UICKeyChainStore</a>，。<br>作者在github上明确说明了使用该框架的条件（如图所示），其中一条是：如果你想在不同的app间共享keychain中的数据，就需要保证这两个app有相同的<a href="https://www.baidu.com/s?wd=bundle%20seed&amp;rsv_spt=1&amp;rsv_iqid=0xf37051390007f61a&amp;issp=1&amp;f=8&amp;rsv_bp=0&amp;rsv_idx=2&amp;ie=utf-8&amp;tn=baiduhome_pg&amp;rsv_enter=0&amp;rsv_sug3=2&amp;rsv_sug1=2&amp;rsv_sug7=101&amp;inputT=1156&amp;rsv_sug4=7573" target="_blank" rel="noopener">bundle seed</a>。那么什么是bundle seed呢？打开钥匙串，找到你的证书，bundle seed就是你证书名后面括号内的的10位编码。所以呢，有相同的bundle seed就意味着是同一个证书发布的应用。</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/814356-0a2b25dcee94231e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="FCUUID.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/814356-47fadea0347eeec9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Bundle seed.png"></p>
<p><em>问题二：如何开启keychain sharing？</em><br>参考这篇文章<a href="http://www.wahenzan.com/a/mdev/ios/2015/0313/1587.html" target="_blank" rel="noopener">iOS Keychain: Sharing data between apps</a>（实际操作步骤不完全相同）。首先保证两个app都是由同一证书创建的–&gt;点击capabilities–&gt;打开keychain sharing–&gt;Xcode会自动帮你生成entitlements文件–&gt;分别在两个不同的项目中的keychain sharing中添加对方的bundle identifier–&gt;显示两个勾选状态–&gt;大功告成。通过真机测试，证实该方案可行。</p>
<p><strong>综上，实际上获取“山寨UDID”的关键在于存储。而想要实现应用间共享数据的最关键之处在于是否是同一证书下管理的app。</strong></p>
<hr>
<p><strong><em>参考文献</em></strong></p>
<p>1.iOS唯一标示符引导：<br><a href="http://www.cocoachina.com/ios/20130422/6040.html" target="_blank" rel="noopener">http://www.cocoachina.com/ios/20130422/6040.html</a></p>
<p>2.iOS平台UDID方案比较：<br><a href="http://www.cocoachina.com/ios/20130715/6597.html" target="_blank" rel="noopener">http://www.cocoachina.com/ios/20130715/6597.html</a></p>
<p>3.KeyChain保存和获取应用的UDID：<br><a href="http://blog.csdn.net/teng_ontheway/article/details/50200491" target="_blank" rel="noopener">http://blog.csdn.net/teng_ontheway/article/details/50200491</a></p>
<p>4.iOS7时代我们用什么来追踪和识别用户：<br><a href="http://www.cnblogs.com/BigPolarBear/p/3359526.html" target="_blank" rel="noopener">http://www.cnblogs.com/BigPolarBear/p/3359526.html</a></p>
<p>5.iOS的UDID废用以及UUID配合keychain的替换方案实现：<br><a href="http://blog.k-res.net/archives/1081.html" target="_blank" rel="noopener">http://blog.k-res.net/archives/1081.html</a></p>
<p>6.iOS设备唯一标识探讨：<br><a href="http://www.jianshu.com/p/b83b0240bd0e" target="_blank" rel="noopener">http://www.jianshu.com/p/b83b0240bd0e</a></p>
<p><strong><em>相关开源框架</em></strong><br>1.OpenUDID（简单易用，但在iOS7以后有局限性，只做参考）：<br><a href="https://github.com/ylechelle/OpenUDID" target="_blank" rel="noopener">https://github.com/ylechelle/OpenUDID</a></p>
<p>2.FCUUID（功能强大，但需设置iCloud / Key-value storage和KeyChain sharing）：<br><a href="https://github.com/fabiocaccamo/FCUUID" target="_blank" rel="noopener">https://github.com/fabiocaccamo/FCUUID</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/11/04/computer-science-illuminated/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">ShannonChenCHN</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>