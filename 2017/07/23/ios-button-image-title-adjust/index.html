<!DOCTYPE html><html lang=""><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> [iOS 开发] 如何调整 UIButton 中的元素（image 和 title）的布局？ · Shannon's Blog</title><meta name="description" content="[iOS 开发] 如何调整 UIButton 中的元素（image 和 title）的布局？ - ShannonChenCHN"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Shannon's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">TAG</a></li><li class="nav-list-item"><a href="https://github.com/ShannonChenCHN" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">[iOS 开发] 如何调整 UIButton 中的元素（image 和 title）的布局？</h1><div class="post-info">Jul 23, 2017</div><div class="post-content"><blockquote>
<p><strong>前言</strong>：在移动 APP 的设计中，我们会经常看到同时带有图片和文字的按钮，这些按钮在 UI 设计师眼中，可能不值一提，但是在 iOS 开发中，由于 Apple 的 SDK 的局限性，实现起来却并不那么愉快。</p>
</blockquote>
<p><strong>关键字</strong>：<code>UIButton</code>，按钮，图文按钮，图片和文字的位置<br><strong>相关源码地址：</strong><a href="https://github.com/ShannonChenCHN/Playground/tree/master/ButtonLayoutDemo" target="_blank" rel="noopener">ButtonLayoutDemo</a></p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li>需求</li>
<li>现实</li>
<li>问题</li>
<li>解决方案</li>
<li>小结</li>
<li>延伸阅读</li>
</ul>
<h3 id="一、需求"><a href="#一、需求" class="headerlink" title="一、需求"></a>一、需求</h3><p>根据以往的经验来看，我们常见的图文按钮样式一般是以下几种的组合：</p>
<ul>
<li>图文布局<ul>
<li>上图下文</li>
<li>上文下图</li>
<li>左图右文</li>
<li>右图左文</li>
</ul>
</li>
<li>对齐方式<ul>
<li>居左</li>
<li>居右</li>
<li>居中</li>
<li>居上</li>
<li>居下</li>
</ul>
</li>
<li>对图片做圆角处理</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/814356-70ad87809a98b07f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="上图下文（图片带圆角）.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/814356-d48f7d6b46dc57aa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="上图下文（整体靠底部对齐）.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/814356-4de1379977bb864c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="上文下图（整体靠底部对齐）.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/814356-a3f1951634b14855.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="系统默认支持的左图右文（整体居中）.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/814356-13df2a835cd4e083.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="左文右图.png"></p>
<h3 id="二、现实"><a href="#二、现实" class="headerlink" title="二、现实"></a>二、现实</h3><p>然而，Cocoa Touch 框架中的 <code>UIButton</code> 只支持左图右文的布局方式，而且还不能直接设置图文间距。</p>
<p>代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UIButton *button = [[UIButton alloc] initWithFrame:CGRectMake(50, 50, 50, 30)];</span><br><span class="line">[button setTitle:@&quot;title&quot; forState:UIControlStateNormal];</span><br><span class="line">[button setImage:icon forState:UIControlStateNormal];</span><br><span class="line">button.contentVerticalAlignment = UIControlContentHorizontalAlignmentCenter;</span><br><span class="line">[self addSubview:button];</span><br></pre></td></tr></table></figure></p>
<p>效果如下：<br><img src="http://upload-images.jianshu.io/upload_images/814356-a3f1951634b14855.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="系统默认支持的左图右文（整体居中）.png"></p>
<h3 id="三、问题"><a href="#三、问题" class="headerlink" title="三、问题"></a>三、问题</h3><p>所以，我们首先要解决的问题是，怎样才能轻松加愉快地实现：</p>
<ul>
<li>图文布局（可设置图文间距）</li>
<li>对齐方式</li>
</ul>
<p>我们所期望的是，只需要简单地设置两个属性就能实现想要的效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">button.interTitleImageSpacing = 4;</span><br><span class="line">button.imagePosition = UIButtonImagePositionRight;</span><br></pre></td></tr></table></figure>
<h3 id="四、解决方案"><a href="#四、解决方案" class="headerlink" title="四、解决方案"></a>四、解决方案</h3><p>我们先来看看 <code>UIButton</code> 的 API ，发现跟内容布局相关的有这些：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@interface UIButton : UIControl</span><br><span class="line">...</span><br><span class="line">@property(nonatomic)          UIEdgeInsets contentEdgeInsets;  // 用来调整按钮整体内容区域的位置和尺寸</span><br><span class="line">@property(nonatomic)          UIEdgeInsets titleEdgeInsets;  // 用来调整按钮文字区域的位置和尺寸</span><br><span class="line">@property(nonatomic)          UIEdgeInsets imageEdgeInsets; // 用来调整按钮图片区域的位置和尺寸</span><br><span class="line"></span><br><span class="line">- (CGRect)contentRectForBounds:(CGRect)bounds;  // 用来计算按钮整体内容区域的大小和位置</span><br><span class="line">- (CGRect)titleRectForContentRect:(CGRect)contentRect;  // 用来计算按钮文字区域的大小和位置</span><br><span class="line">- (CGRect)imageRectForContentRect:(CGRect)contentRect;  // 用来计算按钮图片区域的大小和位置</span><br><span class="line">...</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p><code>UIButton</code> 继承于 <code>UIControl</code>，再来看看 <code>UIControl</code> 中的跟布局相关的 API：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@property(nonatomic) UIControlContentVerticalAlignment contentVerticalAlignment;     // 设置内容在竖直方向的对齐方式</span><br><span class="line">@property(nonatomic) UIControlContentHorizontalAlignment contentHorizontalAlignment;  // 设置内容在水平方向的对齐方式</span><br></pre></td></tr></table></figure>
<p><code>UIControl</code> 继承于 <code>UIView</code>，<code>UIView</code> 是所有视图控件的根类，<code>UIView</code> 中的跟布局相关的 API 有：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 手动触发 layout 的两个方法，其中 - layoutIfNeeded 会强制 layout</span><br><span class="line">- (void)setNeedsLayout;</span><br><span class="line">- (void)layoutIfNeeded;</span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews;   // layout 时该方法会被调用，调用 -layoutIfNeeded 方法会自动触发这个方法</span><br></pre></td></tr></table></figure></p>
<p>找来找去，就是系统提供给我们的就是这些工具了，看菜下饭吧。</p>
<h4 id="方案一：设置-titleEdgeInsets-属性和-imageEdgeInsets-属性的值"><a href="#方案一：设置-titleEdgeInsets-属性和-imageEdgeInsets-属性的值" class="headerlink" title="方案一：设置 titleEdgeInsets 属性和 imageEdgeInsets 属性的值"></a>方案一：设置 <code>titleEdgeInsets</code> 属性和 <code>imageEdgeInsets</code> 属性的值</h4><blockquote>
<p>如果你想要直接看最终实现的代码，请戳这里<a href="https://github.com/ShannonChenCHN/Playground/blob/master/ButtonLayoutDemo/ButtonLayoutDemo/UIButton%2BLayout.m" target="_blank" rel="noopener">UIButton+Layout.m</a>。</p>
</blockquote>
<p><code>titleEdgeInsets</code> ：用来调整按钮文字区域的位置和尺寸。<br><code>imageEdgeInsets</code>：用来调整按钮图片区域的位置和尺寸。</p>
<p><code>titleEdgeInsets</code> 和 <code>imageEdgeInsets</code> 这两个属性都是 <code>UIEdgeInsets</code> 类型，<code>UIEdgeInsets</code> 类型有四个成员变量 <code>top</code>、<code>left</code>、<code>bottom</code>、<code>right</code>，分别表示上左下右四个方向的偏移量，正值代表往内缩进，也就是往按钮中心靠拢，负值代表往外扩张，就是往按钮边缘贴近。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">typedef struct UIEdgeInsets &#123;</span><br><span class="line">    CGFloat top, left, bottom, right;  // specify amount to inset (positive) for each of the edges. values can be negative to &apos;outset&apos;</span><br><span class="line">&#125; UIEdgeInsets;</span><br></pre></td></tr></table></figure></p>
<p>具体怎么用呢？<br><strong>要点：</strong></p>
<ul>
<li>系统默认的布局是内容整体居中，图片在左，文字在右，图片和文字间距为 0。</li>
<li>不论是 <code>titleEdgeInsets</code>，还是 <code>imageEdgeInsets</code>，只设置一个方向的偏移量 A 时，实际效果得到的偏移量是 A / 2。比如想通过<br><code>button.titleEdgeInsets =  UIEdgeInsetsMake(0, 2, 0, 0);</code> 设置按钮标题往右偏移 2 pt， 实际上得到的效果是按钮文字只往右偏移了 1 pt。</li>
</ul>
<p>知道以上两个要点之后，我们就可以开始干活了，如果要想通过设置 <code>titleEdgeInsets</code>和 <code>imageEdgeInsets</code> 来达到我们的要求，该怎么做呢？</p>
<p><strong>1. 左图右文</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 目标图文间距</span><br><span class="line">CGFloat interImageTitleSpacing = 5;</span><br><span class="line">// 获取默认的图片文字间距</span><br><span class="line">CGFloat originalSpacing = button.titleLabel.frame.origin.x - (button.imageView.frame.origin.x + button.imageView.frame.size.width);</span><br><span class="line">// 调整文字的位置</span><br><span class="line">button.titleEdgeInsets = UIEdgeInsetsMake(0,</span><br><span class="line">                                        -(originalSpacing - interImageTitleSpacing),</span><br><span class="line">                                        0,</span><br><span class="line">                                        (originalSpacing - interImageTitleSpacing));</span><br></pre></td></tr></table></figure>
<p><strong>2. 左文右图</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 目标图文间距</span><br><span class="line">CGFloat interImageTitleSpacing = 5;</span><br><span class="line">// 图片右移</span><br><span class="line">button.imageEdgeInsets = UIEdgeInsetsMake(0,</span><br><span class="line">                                          button.titleLabel.frame.size.width + interImageTitleSpacing,</span><br><span class="line">                                          0,</span><br><span class="line">                                          -(button.titleLabel.frame.size.width + interImageTitleSpacing));</span><br><span class="line">// 文字左移</span><br><span class="line">button.titleEdgeInsets = UIEdgeInsetsMake(0,</span><br><span class="line">                                          -(button.titleLabel.frame.origin.x - button.imageView.frame.origin.x),</span><br><span class="line">                                          0,</span><br><span class="line">                                          button.titleLabel.frame.origin.x - button.imageView.frame.origin.x);</span><br></pre></td></tr></table></figure>
<p><strong>3.上图下文</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 目标图文间距</span><br><span class="line">CGFloat interImageTitleSpacing = 5;</span><br><span class="line"></span><br><span class="line">// 图片上移，右移</span><br><span class="line">button.imageEdgeInsets = UIEdgeInsetsMake(0,</span><br><span class="line">                                        0,</span><br><span class="line">                                        button.titleLabel.frame.size.height + interImageTitleSpacing,</span><br><span class="line">                                        -(button.titleLabel.frame.size.width));</span><br><span class="line"></span><br><span class="line">// 文字下移，左移</span><br><span class="line">button.titleEdgeInsets = UIEdgeInsetsMake(button.imageView.frame.size.height + interImageTitleSpacing,</span><br><span class="line">                                        -(button.imageView.frame.size.width),</span><br><span class="line">                                        0,</span><br><span class="line">                                        0);</span><br></pre></td></tr></table></figure></p>
<p><strong>4.上文下图</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 目标图文间距</span><br><span class="line">CGFloat interImageTitleSpacing = 5;</span><br><span class="line"></span><br><span class="line">// 图片下移，右移</span><br><span class="line">button.imageEdgeInsets = UIEdgeInsetsMake(button.titleLabel.frame.size.height + interImageTitleSpacing,</span><br><span class="line">                                        0,</span><br><span class="line">                                        0,</span><br><span class="line">                                        -(button.titleLabel.frame.size.width));</span><br><span class="line"></span><br><span class="line">// 文字上移，左移</span><br><span class="line">button.titleEdgeInsets = UIEdgeInsetsMake(0,</span><br><span class="line">                                        -(button.imageView.frame.size.width),</span><br><span class="line">                                        button.imageView.frame.size.height + interImageTitleSpacing,</span><br><span class="line">                                        0);</span><br></pre></td></tr></table></figure></p>
<p><strong>注意：</strong> 实际上，直接按照上面这么写是不行的，因为设置 <code>titleEdgeInsets</code> 和 <code>imageEdgeInsets</code> 属性时，button 的 <code>titleLabel</code> 和 <code>imageView</code> 的 frame 还没有真正计算好，所以这个时候获取到的 frame 是不准确的，要想拿到布局好的 <code>titleLabel</code> 和 <code>imageView</code> 的 frame ，我们需要先调用 <code>- layoutIfNeeded</code> 方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[button layoutIfNeeded];</span><br><span class="line">//  然后设置 button 的 titleEdgeInsets 和 imageEdgeInsets </span><br><span class="line">// ...</span><br></pre></td></tr></table></figure>
<p><strong>优雅的实现方式：</strong>直接在创建 button 的地方去调用 <code>layoutIfNeeded</code> 进行布局，再去计算 <code>titleEdgeInsets</code> 和 <code>imageEdgeInsets</code>，并不是一个好的做法，比较推荐的做法是，写一个 category 或者 自定义一个 <code>UIButton</code> 的子类，来实现上面的计算，并提供图片文字的布局样式和图文间距的接口。</p>
<p>接口应该长得像这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, SCButtonLayoutStyle) &#123;</span><br><span class="line">    SCButtonLayoutStyleImageLeft,  </span><br><span class="line">    SCButtonLayoutStyleImageRight,</span><br><span class="line">    SCButtonLayoutStyleImageTop,</span><br><span class="line">    SCButtonLayoutStyleImageBottom,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@interface UIButton (Layout)</span><br><span class="line"></span><br><span class="line">- (void)sc_setLayoutStyle:(SCButtonLayoutStyle)style spacing:(CGFloat)spacing;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>使用起来应该像这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">button.contentVerticalAlignment = UIControlContentVerticalAlignmentTop;  // 竖直方向整体居上</span><br><span class="line">button.contentHorizontalAlignment = UIControlContentHorizontalAlignmentCenter;  // 水平方向整体居中</span><br><span class="line">[button sc_setLayoutStyle:SCButtonLayoutStyleImageBottom spacing:20];  // 图片在底部，图文间距 20 pt</span><br></pre></td></tr></table></figure></p>
<p>具体的代码实现见 <a href="https://github.com/ShannonChenCHN/Playground/blob/master/ButtonLayoutDemo/ButtonLayoutDemo/UIButton%2BLayout.m" target="_blank" rel="noopener">UIButton+Layout.m</a></p>
<h4 id="方案二：自定义一个-UIButton-的子类，重写以下两个方法："><a href="#方案二：自定义一个-UIButton-的子类，重写以下两个方法：" class="headerlink" title="方案二：自定义一个 UIButton 的子类，重写以下两个方法："></a>方案二：自定义一个 UIButton 的子类，重写以下两个方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (CGRect)titleRectForContentRect:(CGRect)contentRect;   // 设置文字区域的位置和大小</span><br><span class="line">- (CGRect)imageRectForContentRect:(CGRect)contentRect;  // 设置图片区域的位置和大小</span><br></pre></td></tr></table></figure>
<p>使用这两个方法可以直接指定 <code>titleLabel</code> 和 <code>imageView</code> 的大小和位置，参数 <code>contentRect</code> 是由 <code>-contentRectForBounds:</code> 方法返回值决定的，如果该方法没有被重写，<code>contentRect</code> 就跟 <code>bounds</code> 的值是一样的。</p>
<p><strong>使用案例：</strong><br>例如我们要实现一个上图下文、整体靠顶部对齐、图文间距 20pt 的图案：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/814356-22ec78c00ef5b230.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="上图下文（整体靠顶部对齐）.png"></p>
<p>我们先自定义一个 <code>UIButton</code> 的子类，实现 <code>-titleRectForContentRect:</code> 和 <code>-imageRectForContentRect:</code> 方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@interface CustomButton : UIButton</span><br><span class="line"></span><br><span class="line">@property (assign, nonatomic) CGFloat interTitleImageSpacing;  ///&lt; 图片文字间距</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation CustomButton</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (CGRect)titleRectForContentRect:(CGRect)contentRect &#123;</span><br><span class="line">    </span><br><span class="line">    CGSize titleSize = CGSizeMake(contentRect.size.width, 25);</span><br><span class="line">    </span><br><span class="line">    CGRect imageFrame = [self imageRectForContentRect:contentRect];</span><br><span class="line">    </span><br><span class="line">    return CGRectMake((contentRect.size.width - titleSize.width) * 0.5,</span><br><span class="line">                      imageFrame.origin.y + imageFrame.size.height + self.interTitleImageSpacing,</span><br><span class="line">                      titleSize.width,</span><br><span class="line">                      titleSize.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGRect)imageRectForContentRect:(CGRect)contentRect &#123;</span><br><span class="line">    </span><br><span class="line">    CGSize imageSize = CGSizeMake(25, 24);</span><br><span class="line">    </span><br><span class="line">    return CGRectMake((contentRect.size.width - imageSize.width) * 0.5, 0, imageSize.width, imageSize.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>然后再在外面使用定义好的 <code>CustomButton</code>，然后就得到上图中的效果了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UIButton *button = [[UIButton alloc] initWithFrame:CGRectMake(100, 100, 75, 75)];</span><br><span class="line">[button setImage:[UIImage imageNamed:@&quot;like&quot;] forState:UIControlStateNormal];</span><br><span class="line">[button setTitle:@&quot;title&quot; forState:UIControlStateNormal];</span><br><span class="line">button.interTitleImageSpacing = 20;</span><br><span class="line">button.titleLabel.textAlignment = NSTextAlignmentCenter;</span><br><span class="line">[self.view addSubview:button];</span><br></pre></td></tr></table></figure></p>
<p><strong>注意：</strong>但是，在这两个方法中不能使用 <code>self.titleLabel</code> 和 <code>self. imageView</code>，否则会出现无限递归，造成死循环。也就是说这里面的尺寸和位置计算，都是基于  <code>contentRect</code> 参数的独立逻辑，所以一般只在我们知道图片和文字的具体参数后才会这样做，所以，这种方式使用起来并不灵活。</p>
<h4 id="方案三：自定义一个-UIButton-的子类，重写-layoutSubviews-计算位置"><a href="#方案三：自定义一个-UIButton-的子类，重写-layoutSubviews-计算位置" class="headerlink" title="方案三：自定义一个 UIButton 的子类，重写 layoutSubviews 计算位置"></a>方案三：自定义一个 UIButton 的子类，重写 layoutSubviews 计算位置</h4><p>这个方案的启发来源于腾讯 QMUI 团队开源的 <a href="https://github.com/QMUI/QMUIDemo_iOS/blob/master/QMUI/QMUIKit/UIKitExtensions/QMUIButton.m" target="_blank" rel="noopener">QMUIKit</a>，其主要思想是，所有的 view 在布局时都会调用 <code>-layoutSubviews</code> 方法，你只要告诉我整体内容对齐方式是如何，图文布局什么样，图文间距多大，我就可以在 <code>-layoutSubviews</code> 方法中帮你全部算好。</p>
<p>这种方式的好处在于可控性好，直接对 <code>titleLabel</code> 和 <code>imageView</code> 的 frame 进行操作，不用担心系统实现会不会改动，其次，由于是直接操作 frame，计算起来就比较直观简单，不用像使用<code>titleEdgeInsets</code> 和 <code>imageEdgeInsets</code> 那样把 <code>titleLabel</code> 和 <code>imageView</code> 挪来挪去。唯一不太好的地方在于计算量比较多，光计算布局就写了差不多 150 行代码。</p>
<p>因为  <a href="https://github.com/QMUI/QMUIDemo_iOS/blob/master/QMUI/QMUIKit/UIKitExtensions/QMUIButton.m" target="_blank" rel="noopener">QMUIKit</a> 中的 QMUIButton 太过于庞杂，其中有很多我们并不需要的功能，维护起来也复杂，所以我针对我们自己项目的需求实现了一个更简洁的 <a href="https://github.com/ShannonChenCHN/SCKit/blob/master/SCKit/UIComponents/Classes/SCCustomButton.h" target="_blank" rel="noopener">SCCustomButton</a>，主要支持以下功能：</p>
<ul>
<li>设置图文布局方式</li>
<li>设置图文间距</li>
<li>设置图片圆角大小</li>
<li>设置内容整体对齐方式</li>
</ul>
<p>这是 SCCustomButton 提供的接口：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/// 图片和文字的相对位置</span><br><span class="line">typedef NS_ENUM(NSInteger, SCCustomButtonImagePosition) &#123;</span><br><span class="line">    SCCustomButtonImagePositionTop,     // 图片在文字顶部</span><br><span class="line">    SCCustomButtonImagePositionLeft,    // 图片在文字左侧</span><br><span class="line">    SCCustomButtonImagePositionBottom,  // 图片在文字底部</span><br><span class="line">    SCCustomButtonImagePositionRight    // 图片在文字右侧</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 自定义按钮，可控制图片文字间距</span><br><span class="line"> </span><br><span class="line"> 使用方法：</span><br><span class="line"> @code</span><br><span class="line">     SCCustomButton *button = [[SCCustomButton alloc] initWithFrame:CGRectMake(50, 50, 50, 30)];</span><br><span class="line">     button.imagePosition = SCCustomButtonImagePositionLeft;  // 图文布局方式</span><br><span class="line">     button.interTitleImageSpacing = 5;                       // 图文间距</span><br><span class="line">     button.imageCornerRadius = 15;                           // 图片圆角半径</span><br><span class="line">     button.contentHorizontalAlignment = UIControlContentHorizontalAlignmentCenter;  // 内容对齐方式</span><br><span class="line">     [self addSubview:button];</span><br><span class="line"> @endcode</span><br><span class="line"> */</span><br><span class="line">@interface SCCustomButton : UIButton</span><br><span class="line"></span><br><span class="line">@property (assign, nonatomic) CGFloat interTitleImageSpacing;  ///&lt; 图片文字间距</span><br><span class="line">@property (assign, nonatomic) SCCustomButtonImagePosition imagePosition;     ///&lt; 图片和文字的相对位置</span><br><span class="line">@property (assign, nonatomic) CGFloat imageCornerRadius;                     ///&lt; 图片圆角半径</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>使用起来也非常简单，正好符合我们期望的效果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SCCustomButton *button = [[SCCustomButton alloc] initWithFrame:CGRectMake(50, 50, 50, 30)];</span><br><span class="line">     button.imagePosition = SCCustomButtonImagePositionLeft;  // 图文布局方式</span><br><span class="line">     button.interTitleImageSpacing = 5;                       // 图文间距</span><br><span class="line">     button.imageCornerRadius = 15;                           // 图片圆角半径</span><br><span class="line">     button.contentHorizontalAlignment = UIControlContentHorizontalAlignmentCenter;  // 内容对齐方式</span><br><span class="line">     [self addSubview:button];</span><br></pre></td></tr></table></figure></p>
<h4 id="另辟蹊径：自定义一个-UIView-或者-UIControl-的子类，实现所要求的样式"><a href="#另辟蹊径：自定义一个-UIView-或者-UIControl-的子类，实现所要求的样式" class="headerlink" title="另辟蹊径：自定义一个 UIView 或者 UIControl 的子类，实现所要求的样式"></a>另辟蹊径：自定义一个 <code>UIView</code> 或者 <code>UIControl</code> 的子类，实现所要求的样式</h4><p>当然也可以不使用 <code>UIButton</code>，自己去实现一个继承于 <code>UIView</code> 或者 <code>UIControl</code>  的子类，这是完全可以满足我们所要求的样式的，但是这样就需要自己添加和管理 imageView 和 label，并实现一些  <code>UIButton</code> 的功能（比如点击按钮时的高亮效果），显然是比前面提到的几种方式更复杂，成本也更高。</p>
<h3 id="五、小结"><a href="#五、小结" class="headerlink" title="五、小结"></a>五、小结</h3><p>以上几种调整 <code>UIButton</code> 的文字和图片位置的方法，都有各自的优缺点，综合起来看，方案三的自由度更高，可控性更好，也易于维护，使用起来更是轻松加愉快。</p>
<h3 id="六、延伸阅读"><a href="#六、延伸阅读" class="headerlink" title="六、延伸阅读"></a>六、延伸阅读</h3><ul>
<li><a href="http://www.jianshu.com/p/fb20bce230d9" target="_blank" rel="noopener">调整UIButton的title和image详解</a></li>
<li><a href="http://www.jianshu.com/p/8e4d1aa8b31d" target="_blank" rel="noopener">iOS中如何把UIButton中的图片和文字上下对齐</a></li>
<li><a href="https://github.com/QMUI/QMUIDemo_iOS/blob/master/QMUI/QMUIKit/UIKitExtensions/QMUIButton.m" target="_blank" rel="noopener">腾讯 QMUI 团队开源的 QMUIKit</a></li>
<li><a href="https://stackoverflow.com/questions/4564621/aligning-text-and-image-on-uibutton-with-imageedgeinsets-and-titleedgeinsets/5358259#5358259" target="_blank" rel="noopener">Aligning text and image on UIButton with imageEdgeInsets and titleEdgeInsets</a></li>
<li><a href="https://stackoverflow.com/questions/7100976/how-do-i-put-the-image-on-the-right-side-of-the-text-in-a-uibutton/16725685#16725685" target="_blank" rel="noopener">How do I put the image on the right side of the text in a UIButton?</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2017/08/13/iOS-开发-WebViewJavascriptBridge-从原理到实战/" class="prev">PREV</a><a href="/2017/07/08/react-components-props/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">ShannonChenCHN</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>